name: ci

on:
  push:
    branches:
      - master

jobs:
  setup:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5
      - name: Setup
        run: echo "üéâ Install some dependencies ...."
  build:
    runs-on: ubuntu-22.04
    needs: setup
    steps:
      - name: Build artifact
        run: |
          echo "üöÄ Building binary..."
          echo "hehe" > gog
          echo "‚úÖ Build done"
      - name: Upload artifact
        uses: actions/upload-artifact@834a144ee2d810ac153d4c240eec8d6e4ffdbb1f
        with:
          name: gog-${{ github.sha }}
          path: gog
  test:
    runs-on: ubuntu-22.04
    needs: build
    environment: prod
    steps:
      - uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5
      - name: Test
        run: echo "üéâ Run test suite ...."
  release:
    runs-on: ubuntu-22.04
    needs: test
    steps:
      - name: Download artifact
        uses: actions/download-artifact@f44cd7b40bfd40b7eade724c13f3c8f17f4a4280
        with:
          name: gog-${{ github.sha }}
      - name: Release
        run: |
          echo "üõ≥Ô∏è Ship this build"
          echo "Environment: ${{ job.environment.name }}"
          echo "Actor: $GITHUB_ACTOR"
          echo "Branch: $GITHUB_REF_NAME"
        env:
          GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}
